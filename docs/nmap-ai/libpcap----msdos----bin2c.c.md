# `nmap\libpcap\msdos\bin2c.c`

```
#include <stdio.h>
#include <stdlib.h>
#include <stdarg.h>
#include <time.h>

static void Abort (const char *fmt,...)
{
  va_list args;
  va_start (args, fmt);
  vfprintf (stderr, fmt, args);  // 将格式化的输出写入到标准错误流
  va_end (args);  // 结束可变参数的使用
  exit (1);  // 退出程序并返回错误代码
}

int main (int argc, char **argv)
{
  FILE  *inFile;  // 输入文件指针
  FILE  *outFile = stdout;  // 输出文件指针，默认为标准输出
  time_t now     = time (NULL);  // 获取当前时间
  int    ch, i;

  if (argc != 2)
     Abort ("Usage: %s bin-file [> result]", argv[0]);  // 如果参数个数不为2，调用Abort函数输出错误信息并退出程序

  if ((inFile = fopen(argv[1],"rb")) == NULL)  // 以只读方式打开二进制文件
     Abort ("Cannot open %s\n", argv[1]);  // 如果文件打开失败，调用Abort函数输出错误信息并退出程序

  fprintf (outFile,
           "/* data statements for file %s at %.24s */\n"  // 输出文件名和当前时间到输出文件
           "/* Generated by BIN2C, G. Vanem 1995 */\n",
           argv[1], ctime(&now));

  i = 0;
  while ((ch = fgetc(inFile)) != EOF)  // 逐个读取文件中的字符
  {
    if (i++ % 12 == 0)  // 每12个字符换行
       fputs ("\n  ", outFile);
    fprintf (outFile, "0x%02X,", ch);  // 输出十六进制格式的字符到输出文件
  }
  fputc ('\n', outFile);  // 输出换行符到输出文件
  fclose (inFile);  // 关闭输入文件
  return (0);  // 返回程序执行成功
}
```