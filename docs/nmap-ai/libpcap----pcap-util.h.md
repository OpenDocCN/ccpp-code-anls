# `nmap\libpcap\pcap-util.h`

```cpp
/*
 * 版权声明，版权归加利福尼亚大学所有
 * 允许在源代码和二进制形式下进行再发布和使用，无论是否进行修改：
 * (1) 源代码发布必须保留以上版权声明和本段完整内容
 * (2) 包含二进制代码的发布必须在文档或其他提供的材料中包含以上版权声明和本段完整内容
 * (3) 所有提及此软件特性或使用的广告材料必须显示以下声明：
 * “本产品包括由加利福尼亚大学劳伦斯伯克利实验室及其贡献者开发的软件。”
 * 未经特定事先书面许可，不得使用大学的名称或其贡献者的名称来认可或推广从本软件派生的产品。
 * 本软件按原样提供，不提供任何明示或暗示的担保，包括但不限于对适销性和特定用途的暗示担保。
 *
 * pcap-util.h - 各种文件的通用代码
 */

/*
 * 我们使用“接收者优先”的字节顺序处理方法；
 * 因为在写入文件时时间很宝贵。
 * 换句话说，pcap_file_header 和 pcap_pkthdr 记录以主机字节顺序写入。
 * 请注意，数据包的字节按照接收顺序写入，因此数据包中的多字节字段不是按照主机字节顺序写入，而是按照发送机器放置的顺序写入。
 *
 * 我们还将其用于修复来自远程捕获的数据包数据头，其中服务器的字节顺序可能与客户端不同。
 *
 * ntoh[ls] 不足以解决问题，因为我们可能需要在大端序机器上进行交换（如果文件是以小端序写入的）。
 */
# 定义一个宏，用于交换32位整数的字节顺序
#define SWAPLONG(y) \
    (((((u_int)(y))&0xff)<<24) | \  # 将第一个字节左移24位，然后按位或操作
     ((((u_int)(y))&0xff00)<<8) | \  # 将第二个字节左移8位，然后按位或操作
     ((((u_int)(y))&0xff0000)>>8) | \  # 将第三个字节右移8位，然后按位或操作
     ((((u_int)(y))>>24)&0xff))  # 将最后一个字节右移24位，然后按位与操作

# 定义一个宏，用于交换16位整数的字节顺序
#define SWAPSHORT(y) \
     ((u_short)(((((u_int)(y))&0xff)<<8) | \  # 将第一个字节左移8位，然后按位或操作
                ((((u_int)(y))&0xff00)>>8)))  # 将第二个字节右移8位，然后按位或操作

# 声明一个外部函数，用于处理捕获数据包后的后续处理
extern void pcap_post_process(int linktype, int swapped,
    struct pcap_pkthdr *hdr, u_char *data);

# 声明一个外部函数，用于修正捕获数据包的包头信息
extern void fixup_pcap_pkthdr(int linktype, struct pcap_pkthdr *hdr,
    const u_char *data);
```